<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Danke!</title>
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; background:#f8f7fa; margin:0;
           display:flex; align-items:center; justify-content:center; height:100vh; color:#1e293b; }
    .card { background:#fff; border:1px solid #e2e8f0; border-radius:20px; padding:32px 28px;
            max-width:520px; width:92%; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    h1 { font-size:1.5rem; font-weight:700; color:#1e293b; margin:0 0 12px; }
    p { margin:0 0 16px; color:#475569; }
    .btn { display:inline-block; background:#6366f1; color:#fff; padding:12px 20px; border-radius:12px;
           text-decoration:none; font-weight:600; }
    .btn:hover{ background:#4f46e5; }
    .small{ font-size:13px; color:#94a3b8; margin-top:12px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Danke für deine Angabe!</h1>
    <p>Deine Verfügbarkeiten wurden gespeichert. Du wirst gleich automatisch weitergeleitet.</p>
    <a id="link" class="btn" href="#">Zurück zur App</a>
    <div id="hint" class="small">Falls nichts passiert, klicke auf den Button.</div>
  </div>

  <script>
    // Holt die Portal-ID robust aus ?portalId=..., ?id=..., ?=rec..., oder aus dem Hash
    function findPortalId() {
      const qs = new URLSearchParams(location.search);

      // Bevorzugte Keys
      let v = qs.get('portalId') || qs.get('id');
      if (v) return v.trim().replace(/%23$/, '').replace(/#$/, '');

      // Leerer Key: ?=recXXXXXXXXXXXXXX
      const emptyKeyVal = qs.get('');
      if (emptyKeyVal) return emptyKeyVal.trim().replace(/%23$/, '').replace(/#$/, '');

      // Fallback: Airtable-ID-Muster im Query/Hash
      const all = (location.search + '&' + location.hash);
      const m = all.match(/rec[A-Za-z0-9]{14}/);
      return m ? m[0] : '';
    }

    const portalId = findPortalId();

    // *** Ziel-URL: submitted=1 VOR dem Hash, damit die App den Toast sicher findet ***
    const target = portalId
      ? `https://www.burnouthilfe.org/app/V2/?id=${encodeURIComponent(portalId)}&submitted=1#bestaetigte-termine-page`
      : `https://www.burnouthilfe.org/app/V2/`;

    // Button klickbar machen
    document.getElementById('link').href = target;

    // Auto-Weiterleitung
    if (portalId) {
      setTimeout(() => {
        if (window.top) window.top.location.href = target;
        else location.href = target;
      }, 1200);
    } else {
      document.getElementById('hint').textContent =
        'Portal-ID fehlt – bitte über den App-Link neu einsteigen.';
    }
  </script>
</body>
</html>
